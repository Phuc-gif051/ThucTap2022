- hosts: agent
  remote_user: root
  tasks:
  - name: Install EPEL Releases
    yum:
      name: epel-release
      state: present

  - name: Install Zabbix Repository
    yum:
      name: https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm
      state: present

  - name: Install Zabbix agent
    yum:
      name: zabbix-agent

  - name: Start and enabled Zabbix agent processes
    service:
      name: zabbix-agent
      state: started
      enabled: True

  - name: Configure file /etc/zabbix/zabbix_agentd.conf
    ansible.builtin.replace:
      path: /etc/zabbix/zabbix_agentd.conf
      regexp: 'Server='
      replace: 'Server=0.0.0.0/0, '

  - name: Configure hostsname in file /etc/zabbix/zabbix_agentd.conf
    ansible.builtin.replace:
      path: /etc/zabbix/zabbix_agentd.conf
     # after: 'Hostname= '
      regexp: 'Hostname= '
      replace: '# Hostname= '
#    loop: 
#    - 01
#    - 02
#    - 03
  - name: Restart Zabbix  agent processes
    service:
      name: zabbix-agent
      state: restarted

